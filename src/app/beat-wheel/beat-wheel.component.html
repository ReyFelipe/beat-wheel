<!-- <a class="finishLink" (click)="stop()" href="https://forms.office.com/Pages/ResponsePage.aspx?id=i9hQcmhLKUW-RNWaLYpvlCXWBXp261NJvh8j9BmJLtJUQUpXT1VTOFBMTjlKMkZCWTRTSEdFMUwwRS4u" target="_blank" rel="noopener noreferrer">
    <button type="button" class="position-absolute finish btn btn-primary whiteBtn m-2">Finish</button>
</a> -->


<div *ngIf="showAll" class="row m-0 h-100">
    <div class="display d-flex col-12 col-lg-6 h-100 align-items-center justify-content-center">
        <div class="topControls col-12 col-lg-6 position-absolute px-2 px-sm-5 px-lg-0 d-flex flex-column flex-lg-row align-items-center justify-content-between">
            <div class="d-flex flex-row w-100 m-5 mb-0 mb-lg-5">
                <div class="d-flex flex-row flex-lg-column justify-content-between col-12 col-lg-auto">
                    <button type="button" [ngClass]="{'active': spin}" class="btn btn-primary whiteBtn playBtn m-2" (click)="spin ? stop() : playSounds()">
                        <span class="d-none d-md-inline">{{spin ? 'Stop' : 'Play'}} </span>
                        <i *ngIf="!spin" class="mx-1 fas fa-play"></i><i *ngIf="spin" class="mx-1 fas fa-stop"></i>
                    </button>
                    <div class="d-flex flex-row">
                        <button type="button" class="btn btn-primary whiteBtn m-2" (click)="clear()">Clear</button>
                        <button type="button" class="btn btn-primary whiteBtn m-2" (click)="reset()">Randomise</button>
                    </div>
                </div>
                <button type="button" (click)="controlModal=true" class="d-none d-lg-inline btn h-25 my-auto controlModalBtn btn-primary grayBtn mx-2"><i class="fas fa-question"></i></button>
            </div>

            <div class="scaleControl d-flex flex-row flex-lg-column flex-xl-row w-100 me-3 me-lg-5 mt-2 mt-lg-0 justify-content-end align-items-center justify-content-xl-end">
                <span class="me-2 me-lg-0 me-xl-2">Scale</span>
                <div class="text-center">
                    <button *ngFor="let s of scales" [ngClass]="{'active': scaleIndex+1==s}" 
                    (click)="changeScale(s)" class="scale">{{s}}</button>
                </div>
            </div>
        </div>


        <div class="line d-flex position-absolute"></div>
        <div *ngFor="let instrument of instruments" class="wheel d-flex align-items-center justify-content-center">
            <app-beat-layer [instrument]="instrument" [activeInstrument]="instrumentChange" [spin]="spin" (selectInstrument)="selectInstrument(instrument)"
            [notesChanged]="notesChanged" class="layer d-flex position-absolute" [ngStyle]="calculatePieSize(instrument)"></app-beat-layer>
        </div>

        <div class="chooseInstrument position-absolute text-center">
            <button *ngFor="let instrument of instruments" class="btn m-2 m-lg-3 instrumentBtn" (click)="selectInstrument(instrument)"
            [ngClass]="{'active': instrument == activeInstrument}" [ngStyle]="{'background-color': instrument.colours[0], 'border-color': instrument.colours[0],
                'color': instrument.name=='Hi-Hat' ? 'rgb(127,119,0)' : (instrument.name=='808' || instrument.name=='Synth') ? instrument.colours[2] : instrument.colours[1]}">
                {{instrument.name}}
            </button>
        </div>
    </div>

    <div *ngFor="let instrument of instruments" [ngClass]="{'hidden': instrument != activeInstrument}" class="edit d-flex col-12 col-lg-6 h-100 align-items-center justify-content-center">
        <app-layer-edit class="w-100 h-100 d-flex justify-content-center align-items-center" [instrument]="instrument" [instrumentChange]="instrumentChange" (notesChanged)="notesChanged.emit()"
        [spin]="spin" [clearAll]="clearAll" [editing]="editing" (editActive)="editing=!editing" [solo]="solo" (soloActive)="soloActive(instrument)" (deselectInstrument)="deselectInstrument()"></app-layer-edit>
    </div>

    <div *ngIf="!activeInstrument.name" class="helpText p-5 text-center d-none d-lg-flex col-6 h-100 align-items-center justify-content-center">
        <h1>Select an instrument to edit it</h1>
    </div>
</div>


<app-modal *ngIf="modalOpen" [multipage]="true">
    <div class="mp1 text-center">
        <h1 class="mh1">Beat Wheel</h1>
        <h2 class="mh2 my-3">Overview</h2>
        <p class="mp">Thank-you for taking part in my final year research project! The purpose of this project is to design an application with the potential to remove barriers to entry 
        for creating digital music. 
        <p>Feel free to play around for as long as you want, ideally until you've made a track that you're happy with. Use headphones for the best experience.
        Click the 'Finish' button in the bottom right corner when you're ready, and you'll be taken to a brief questionnaire. Its purpose is to gather
        some general information about your experience with the beat maker, mainly focusing on how much you enjoyed it, and how easy it was to use.</p>
        <p>The questionnaire will be completely anonymous, and the answers obtained from research participants will be included in the project report. 
        Your involvement is of course voluntary, and you can choose to stop at any time without completing the questionnaire.</p>
    </div>

    <div class="mp2 text-center">
        <h2 class="mh2 my-3">Controls</h2>
        <p class="mp">You can view the Controls at any point by clicking 'Controls' in the bottom right corner,
            so you can skip this section and come back later if you want. 
        </p>
        <p class="mp">Click 'Play' to start the music loop. If for any reason the music falls out of sync with the notes in the view,
        click 'Stop' then 'Play' again to re-align them. If you're in Safari and there's no sound, switching to Chrome or Firefox may fix the issue.</p>
        <p class="mp">The circles on the left represent 5 instruments you would commonly hear in a trap beat. From the center: kick, 808, snare, hi-hat, synth.
        Click any circle (or its label below) to view it on the right side, where you can drag the wheel to change its pitch/fade, or change the individual 
        notes by clicking 'Edit'. Clicking 'Solo' will isolate that instrument, muting all others.</p>
        <p class="mp">In the bar graph view, click on a note to select it. Drag the bar across the graph to
            change its position. Drag the top marker up/down to change the note's volume.
            If the instrument is '808' or 'Synth', you can use the markers on the left and right to change the note's length.
            These two instruments also allow you to change the sound of the note by clicking the circles next to 'Note' underneath the graph. 
        </p>
    </div>

    <div class="mp3 text-center">
        <h2 class="mh3">Consent</h2>
        <p class="my-4">I consent to participating in this research project<input id="checkbox1" class="mx-3" type="checkbox" name="consent1" [(ngModel)]="consent1"></p>
        <p class="my-4">I consent to my questionnaire answers being used anonymously in the project report<input id="checkbox2" class="mx-3" type="checkbox" name="consent2" [(ngModel)]="consent2"></p>
    </div>

    <button type="button" class="btn mbtnClose btn-primary whiteBtn m-2" (click)="modalOpen=false" [disabled]="!(consent1 && consent2)">Start</button>
</app-modal>



<app-modal *ngIf="controlModal">
    <div class="mp1 text-center">
        <h2 class="mh2 my-3">Controls</h2>

        <p class="mp">Click 'Play' to start the music loop. If for any reason the music falls out of sync with the notes in the view,
        click 'Stop' then 'Play' again to re-align them. If you're in Safari and there's no sound, switching to Chrome or Firefox may fix the issue.</p>

        <p class="mp">The circles on the left represent 5 instruments you would commonly hear in a trap beat. From the center: kick, 808, snare, hi-hat, synth.
        Click any circle (or its label below) to view it on the right side, where you can drag the wheel to change its pitch/fade, or change the individual 
        notes by clicking 'Edit'. Clicking 'Solo' will isolate that instrument, muting all others.</p>

        <p class="mp">In the bar graph view, click on a note to select it. Drag the bar across the graph to
            change its position. Drag the top marker up/down to change the note's volume.
            If the instrument is '808' or 'Synth', you can use the markers on the left and right to change the note's length.
            These two instruments also allow you to change the sound of the note by clicking the circles next to 'Note' underneath the graph. 
        </p>
    </div>

    <button type="button" class="btn mbtnClose btn-primary whiteBtn m-2" (click)="controlModal=false">Continue</button>

</app-modal>